---
published: true
layout: single
title: "[k8s] Kubernetes Summary"
category: k8s
tags:
comments: true
sidebar:
  nav: "mainMenu"
--- 
<br>
쿠버네티스 실습 및 정리한 페이지 입니다. 참고로 클러스터는 Ubuntu 환경에서 3개의 Node를 VBox Ubuntu 가상환경으로 구성하였습니다.

* * *
# Node
- Kubernetes는 Container를 Pod 내에 배치하고 Node에서 실행함으로 워크로드를 구동함.
- Node는 구성한 Cluster에 따라 가상 또는 물리적 머신일 수 있음. 
- 각 노드는 control-plane(node 중 하나)에 의해 관리되며 Pod를 실행하는 데 필요한 Service를 포함한다.
- Node의 구성 방법에 대해서는 따로 기재하지 않음.

#### Command
```
kubectl get node %namespace%
```
<br>
![image](https://github.com/ysbaekFox/ysbaekFox.github.io/assets/54944434/0dddae4e-c822-4379-baa9-67e6b755a212)

```
kubectl describe node %node_name%
```
![image](https://github.com/ysbaekFox/ysbaekFox.github.io/assets/54944434/3b438b7e-7c89-43bf-9746-d386492819f0)

<br>

# Pod
- Pod의 안에는 Container들이 존재
- 각각의 Container들은 Service가 연결될 수 있도록 Port를 가지고 있다.
- 한 Cotainer는 하나 이상의 Port를 가질 수 있지만, Container간에 중복되는 Port는 가질 수 없다.
- Pod내의 Container들은 하나의 Host로 묶여있다, 그래서 다른 Container에 접근할 때 localhost를 사용할 수 있다.
- Pod가 생성 될 때 고유한 IP가 자동으로 할당 되는데, 해당 IP는 클러스터 내부에서만 접근 가능하다. 그리고 Pod가 재생성 될 경우 IP 주소는 변경된다.

# Label
- Label은 Pod 뿐만아니라 모든 오브젝트에 추가할 수 있음 (Pod에서 가장 많이 사용)
- 오브젝트들을 목적에 따라 분류하고 분류한 오브젝트들만 따로 연결하기 위해서 사용
- Label은 key/value가 한쌍 ex) type:wep, lo:dev, type:db, lo:prod

# Node Scheldule
- Pod는 특정 Node에 할당되어야 하는데, 자동으로 할당 되는 것과 직접 스케쥴링하는 방법이 있음.
- 직접 Node를 할당하는 경우, Node에 Label을 달아주고, Pod를 생성할 때 nodeSelector 항목에 Node의 Label과 매칭되는 key value를 넣어주면 됨.
- 자동으로 Node를 할당하는 경우 yaml에 memory 등을 제한하는 항목을 추가하면 자원 상태에 따라 스케줄러가 판단하여 자동으로 Node에 할당한다.

#### Command

```
kubectl create -f %yaml_file%
kubectl apply -f %yaml_file%
kubectl delete -f %yaml_file%
```

```
kubectl describe pod %pod_name% -n %namespace%
```

```
kubectl get pod %pod_name% (default)
kubectl get pod %pod_name% -n %namespace% (specific namespace)
kubectl get pod %pod_name% -A (all namespace)
kubectl get pod %pod_name% --all-namespaces=true (all namespace)
```

```
# -i: --stdin 컨테이너에 표준 입력을 연결, 컨테이너 내부에서 사용자의 입력을 받을 수 있음.
# it: --tty 컨테이너에 터미널을 할당, 컨테이너 내부에서 터미널과 상호작용할 수 있음.
kubectl exec -i -t %pod_name% -c %container_name% -- /bin/bash
```

#### yaml 예시

**1) Pod 생성**
- container1/container2라는 pod를 생성한다.
- image는 각각 kubetm/p8000와 kubetm/p8080을 사용한다.
- containerPort는 각각 8000과 8080을 사용한다.

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: pod-1
spec:
  containers:
  - name: container1
    image: kubetm/p8000
    ports:
    - containerPort: 8000
  - name: container2
    image: kubetm/p8080
    ports:
    - containerPort: 8080
```

**2) label 추가하여 Pod 생성**
- type: web, lo: dev로 label 추가하여 pod 생성

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: pod-2
  labels:
    type: web
    lo: dev
spec:
  containers:
  - name: container
    image: kubetm/init
```

**3) Node Schedule 사용하여 Pod 생성**